# Spec: Update Global Prompt Templates

**Task ID**: 003-006
**JTBD**: 003 - Project-Scoped Execution
**Dependencies**: 003-004 (Support {project} placeholder in prompts)

---

## Purpose

Update the default prompt templates (`PROMPT_plan.md` and `PROMPT_build.md`) generated by `ralphctl init` to use the `{project}` placeholder for specs and implementation plan paths. This allows Ralph loops to work seamlessly with both global (flat) specs and project-scoped specs using the same prompt templates.

---

## Scope

### In Scope
- Modify the `ralphctl init` command to generate updated prompt templates
- Update `PROMPT_plan.md` template to reference `{project}/specs/` and `{project}/IMPLEMENTATION_PLAN.md`
- Update `PROMPT_build.md` template to reference `{project}/specs/` and `{project}/IMPLEMENTATION_PLAN.md`
- Ensure templates work for both:
  - Global mode: `{project}` resolves to `.` (current directory)
  - Project mode: `{project}` resolves to `projects/<name>/`
- Maintain backward compatibility with existing workflows

### Out of Scope
- Modifying existing user prompt files (users must re-run `init` or update manually)
- Adding new prompt templates beyond plan and build
- Changing the core Ralph loop logic (handled by 003-004)
- Auto-migration of existing prompts

---

## Acceptance Criteria

### AC1: Template Generation
- [ ] Running `ralphctl init` creates `PROMPT_plan.md` with `{project}` placeholders
- [ ] Running `ralphctl init` creates `PROMPT_build.md` with `{project}` placeholders
- [ ] Templates reference `{project}/specs/` for spec files
- [ ] Templates reference `{project}/IMPLEMENTATION_PLAN.md` for task tracking

### AC2: Global Mode Compatibility
- [ ] When used without `--project` flag, `{project}` resolves to `.` (current directory)
- [ ] Prompts reference `./specs/` and `./IMPLEMENTATION_PLAN.md` in global mode
- [ ] Existing flat-structure workflows continue to work without modification

### AC3: Project Mode Functionality
- [ ] When used with `--project foo`, `{project}` resolves to `projects/foo`
- [ ] Prompts reference `projects/foo/specs/` and `projects/foo/IMPLEMENTATION_PLAN.md`
- [ ] Path resolution happens before prompt is sent to agent

### AC4: Template Content
- [ ] Plan mode template includes instruction to study specs in `{project}/specs/`
- [ ] Plan mode template includes instruction to update `{project}/IMPLEMENTATION_PLAN.md`
- [ ] Build mode template includes instruction to read tasks from `{project}/IMPLEMENTATION_PLAN.md`
- [ ] Build mode template includes instruction to verify against specs in `{project}/specs/`
- [ ] Templates maintain all other existing Ralph loop best practices

---

## Implementation Notes

### Template Location
The prompt templates should be stored in the ralphctl codebase (likely in a `templates/` directory or embedded in the init command code) and written to the current directory when `ralphctl init` is executed.

### Placeholder Resolution
This task only updates the templates. The actual `{project}` → path resolution is handled by Task 003-004. The templates should use the literal string `{project}` which will be replaced at runtime.

### Example Template Structure

**PROMPT_plan.md** should include:
```markdown
# Ralph Planning Mode

Study the specifications in `{project}/specs/` to understand what needs to be built.

Analyze the current codebase and identify gaps between the specs and implementation.

Update `{project}/IMPLEMENTATION_PLAN.md` with a task list...
```

**PROMPT_build.md** should include:
```markdown
# Ralph Build Mode

Read tasks from `{project}/IMPLEMENTATION_PLAN.md`.

Pick the highest priority incomplete task.

Verify your implementation against the specifications in `{project}/specs/`...
```

### Backward Compatibility Strategy
When `{project}` is not defined (global mode), it should resolve to `.` so that:
- `{project}/specs/` → `./specs/`
- `{project}/IMPLEMENTATION_PLAN.md` → `./IMPLEMENTATION_PLAN.md`

This ensures existing flat-structure workflows work without changes.

### Testing Approach
1. Run `ralphctl init` and verify template files are created
2. Check template content includes `{project}` placeholders in correct locations
3. Test with global mode (no --project flag) - verify paths resolve to current directory
4. Test with project mode (--project test-project) - verify paths resolve to `projects/test-project/`
5. Ensure both modes can successfully run Ralph loops

### Edge Cases
- **No specs folder**: If `{project}/specs/` doesn't exist, Ralph loop should handle gracefully (likely an error, not template concern)
- **Empty project placeholder**: If placeholder resolution fails, should use `.` as safe default
- **Nested projects**: Not supported - prompts assume single-level project structure

### Files to Modify
- Template storage (new `templates/PROMPT_plan.md` and `templates/PROMPT_build.md` or embedded strings)
- `ralphctl init` command implementation to use updated templates
- Any existing hardcoded prompt generation logic

---

## Verification Steps

1. **Generate new templates**:
   ```bash
   ralphctl init
   ```
   - Verify `PROMPT_plan.md` exists with `{project}` placeholders
   - Verify `PROMPT_build.md` exists with `{project}` placeholders

2. **Test global mode**:
   ```bash
   ralphctl run plan
   ```
   - Should work with existing flat `specs/` folder
   - Agent should receive paths like `./specs/`

3. **Test project mode**:
   ```bash
   ralphctl run plan --project test-project
   ```
   - Agent should receive paths like `projects/test-project/specs/`
   - Should fail gracefully if project doesn't exist

4. **Content verification**:
   - Open generated `PROMPT_plan.md` and verify it contains:
     - Reference to `{project}/specs/` for reading specs
     - Reference to `{project}/IMPLEMENTATION_PLAN.md` for updating task list
   - Open generated `PROMPT_build.md` and verify it contains:
     - Reference to `{project}/IMPLEMENTATION_PLAN.md` for reading tasks
     - Reference to `{project}/specs/` for verification

5. **Backward compatibility**:
   - Existing repos with old prompt templates should continue working
   - Users can update by re-running `ralphctl init` (may need --force flag)

---

## Related Tasks

- **003-004**: Implements the actual `{project}` placeholder resolution logic
- **003-001**: Adds `--project` flag to run command
- **003-002**: Adds `--project` flag to step command
- **002-006**: Creates project specs that these templates will consume

---

## Success Indicators

- Template generation works on first try
- Both global and project modes work with same templates
- No breaking changes to existing workflows
- Clear path references in generated prompts
- Documentation updated to explain `{project}` placeholder
